{# {{ include(_self|replace({ "content.html.twig": "header.html.twig" })) }} #}

<main class="main d-print-none">

    {% if card %}

    <section id="card" class="container shadow mt-4 pb-3">

        <h1 class="h6 text-uppercase fw-bolder">
            Шины для {{ card.brand_name }} {{ card.model_name }} {{ card.modification_name }} ({{ card.model_code }}
            )
        </h1>


        {% set image_path = null %}

        {% if card.model_image_ext is defined and card.model_image_ext is not null %}
            {% set img_host =  card.model_image_cdn == true  ? CDN_HOST : '' %}
            {% set img_dir = card.model_image %}
            {% set img_file = (img_host is empty ? '/image.' : '/small.') ~ card.model_image_ext %}
            {% set image_path = img_host ~ img_dir ~ img_file %}
        {% endif %}

        <div class="rounded-5 border lazy bg-contain my-3"
             data-bg="{{ image_path }}"
             title="{{ card.brand_name }} {{ card.model_name }} {{ card.modification_name }} {{ card.model_code }}"
             style="width: 100%; height: 250px; background-image: url('/assets/img/empty.webp');"
        >

        </div>

        {{ include(_self|replace({ "content.html.twig": "_characteristic.html.twig" })) }}

    </section>


    <section class="container shadow pb-3">

        <div class="pt-4 px-2">
            <h2 class="text-uppercase h5 fw-bolder">Шины
                для {{ card.brand_name }} {{ card.model_name }} {{ card.modification_name }}</h2>
        </div>


        <div class="d-flex justify-content-between">

            <ul class="nav nav-pills d-flex gap-3 pb-4 mt-4" id="pills-tab" role="tablist">

                <li class="nav-item" role="presentation">
                    <button class="btn nav-link fw-bolder rounded-4 px-3 active" id="pills-all-tab"
                            data-bs-toggle="pill"
                            data-bs-target="#pills-all" type="button" role="tab"
                            aria-controls="pills-all"
                            aria-selected="true">Все
                    </button>
                </li>

                {% for key, tire in tir %}

                    <li class="nav-item" role="presentation">
                        <button class="btn nav-link fw-bolder"
                                id="pills-{{ key|md5 }}-tab"
                                data-bs-toggle="pill"
                                data-bs-target="#pills-{{ key|md5 }}"
                                type="button" role="tab"
                                aria-controls="pills-{{ key|md5 }}"
                        >
                            <span class="text-uppercase px-3">R{{ key }}</span>
                        </button>
                    </li>

                    {% set selected = false %}

                {% endfor %}

                {# В наличии #}
                {# {% set presence = product_offers|filter(v => v.quantity > 0)|length %} #}
                {% set presence = 0 %}

            </ul>

        </div>


        {% set tablehead %}
            <thead>
            <tr>
                <th scope="col"></th>
                {# <th scope="col">Артикул</th> #}
                <th scope="col">Наименование</th>
                {# <th scope="col">Размер</th>
                <th scope="col">Характеристики</th> #}
                <th scope="col">Наличие</th>
                <th scope="col">Цена</th>
                <th scope="col">Купить</th>
            </tr>
            </thead>
        {% endset %}


        <div class="d-flex justify-content-between gap-3">

            <div class="tab-content w-100 small" id="pills-tabContent">

                <div class="tab-pane fade show active" id="pills-all" role="tabpanel"
                     aria-labelledby="pills-all-tab"
                     tabindex="0">


                    <table class="table table-striped table-borderless">
                        {{ tablehead }}
                        <tbody>
                        {% for key, product_offers in tir %}

                            {# {% set product_offers = product_offers|filter(v => v.quantity > 0) %} #}

                            {% if product_offers is not empty %}
                                {# {% set arr_property = product_offers.category_section_field|json_decode %} #}
                                {{ include(_self|replace({ "content.html.twig": "/_alternative.html.twig" })) }}
                            {% endif %}

                        {% endfor %}


                        </tbody>
                    </table>


                </div>

                {% for key, product_offers in tir %}

                    <div class="tab-pane fade" id="pills-{{ key|md5 }}" role="tabpanel"
                         aria-labelledby="pills-{{ key|md5 }}-tab"
                         tabindex="0">


                        <table class="table table-striped table-borderless">

                            {{ tablehead }}
                            <tbody>
                            {{ include(_self|replace({ "content.html.twig": "_alternative.html.twig" })) }}
                            </tbody>
                        </table>


                    </div>

                {% endfor %}

            </div>

        </div>

    </section>


    <section id="tablist" class="p-3">

        <div class="mb-3">

            <h3 class="h6">Размеры шин
                для {{ card.brand_name }} {{ card.model_name }} {{ card.modification_name }}</h3>

            <div class="d-flex flex-wrap gap-3">
                {% set tires = card.tire_field|json_decode %}

                {% for tire in tires %}

                    {% if tires|length == 1 and tire.width is empty and tire.profile is empty and tire.radius is empty %}

                        <div class="alert alert-warning" role="alert">
                            К сожалению у нас нет информации о рекомендуемых размерах шин
                            для {{ card.brand_name }} {{ card.model_name }} {{ card.modification_name }}
                        </div>


                    {% else %}

                        <a
                                href="{# /product/triangle_tr259/19/225/55 #}"
                                class="text-decoration-none text-dark"
                                title="Шины для {{ card.brand_name }} {{ card.model_name }} {{ card.modification_name }} {{ tire.width }}/{{ tire.profile }} R{{ tire.radius }}">
                            <div class="w-100">{{ tire.width }}/{{ tire.profile }}
                                R{{ tire.radius }}</div>
                        </a>

                    {% endif %}


                {% endfor %}


            </div>

        </div>


        {# {{ include(_self|replace({ "content.html.twig": "tablist.html.twig" })) }} #}
    </section>

    {% else %}


    <section class="selection-box container my-4 shadow pb-3">


        <div class="accordion accordion-flush mt-3" id="accordionExample">
            <div class="accordion-item rounded-4 {# bg-info #} shadow">

                <h2 id="headingOne">
                    <button class="accordion-button rounded-4 ps-4 pe-2 py-2 border-0 bg-primary shadow-none collapsed"
                            type="button"
                            aria-label="Подбор шин"
                            data-bs-toggle="collapse"
                            data-bs-target="#collapseOne"
                            aria-expanded="true"
                            aria-controls="collapseOne">
						<span class="h5 text-uppercase fw-bold text-white mb-0">
							Подбор по авто
						</span>
                    </button>
                </h2>

                <div id="collapseOne" class="accordion-collapse collapse" aria-label="headingOne"
                     data-bs-parent="#accordionExample">

                    <div class="accordion-body">
                        {% include '@reference-cars/user/filter/mobile/filter.html.twig' %}
                    </div>
                </div>
            </div>
        </div>

    </section>


    <div class="container">

        <ul class="nav nav-pills d-flex gap-3 mb-2" id="pills-tab" role="tablist">


            <li class="nav-item" role="presentation">
                <button class="btn nav-link fw-bolder active"
                        id="pills-popular-tab"
                        data-bs-toggle="pill"
                        data-bs-target="#pills-popular"
                        type="button" role="tab"
                        aria-controls="pills-popular"
                >
                    <span class="text-uppercase px-3">Популярные марки</span>
                </button>
            </li>

            <li class="nav-item " role="presentation">
                <div class="w-100">
                    <button class="btn nav-link fw-bolder"
                            id="pills-all-tab"
                            data-bs-toggle="pill"
                            data-bs-target="#pills-all"
                            type="button" role="tab"
                            aria-controls="pills-all"
                    >
                        <span class="text-uppercase px-3">Все <small>({{ brands|length }})</small></span>
                    </button>
                </div>
            </li>

        </ul>

    </div>


    <div class="tab-content w-100 shadow" id="pills-tabContent">


        <div class="tab-pane fade show active"
             id="pills-popular" role="tabpanel" aria-labelledby="pills-popular-tab"
             tabindex="0">

            <section class="cards-box ">

                <div class="container">
                    <div class="row">

                        <div class="col-12">

                            <div class="row cards-box-body mt-3">

                                {% for brand in brands|sort((a, b) => a.brand_review <=> b.brand_review)|reverse|slice(0, 6) %}
                                    <div class="col-6">
                                        {{ include(_self|replace({ "content.html.twig":"brand.html.twig" })) }}
                                    </div>
                                {% endfor %}
                            </div>
                        </div>


                    </div>
                </div>
            </section>

        </div>


        <div class="tab-pane fade"
             id="pills-all" role="tabpanel" aria-labelledby="pills-all-tab"
             tabindex="0">

            <div class="d-flex container" {# style="margin-top: -40px;" #}>
                <ul class="nav nav-pills d-flex gap-1 mb-2 mt-3" id="alphabet-tab" role="tablist">

                    {% set ALPHABET = null %}
                    {% set br = null %}

                    {% for brand in brands %}

                        {% set ABC = brand.brand_name|slice(0, 1)|upper %}

                        {% if ALPHABET != ABC %}

                            <li class="nav-item" role="presentation">
                                <button class="btn nav-link fw-bolder px-1 {{ loop.first ? 'active' }}"
                                        id="alphabet-{{ ABC }}-tab"
                                        data-bs-toggle="pill"
                                        data-bs-target="#alphabet-{{ ABC }}"
                                        type="button" role="tab"
                                        aria-controls="alphabet-{{ ABC }}"
                                >
                                    <span class="text-uppercase p-2">{{ ABC }}</span>
                                </button>
                            </li>

                        {% endif %}

                        {% set ALPHABET = ABC %}

                    {% endfor %}

                </ul>
            </div>


            <div class="tab-content w-100" id="alphabet-tabContent">


                {% set ALPHABET = null %}

                {% for brand in brands %}

                {% set ABC = brand.brand_name|slice(0, 1)|upper %}

                {% if ALPHABET != ABC %}

                {% if ALPHABET is not null %}

            </div>
        </div>
    </div>
    </div></section>
    </div>
    {% endif %}




    <div class="tab-pane fade {{ loop.first ? 'show active' }}"
         id="alphabet-{{ ABC }}" role="tabpanel" aria-labelledby="alphabet-{{ ABC }}-tab"
         tabindex="0">
        {# ALPHABET {{ ABC }} #}


        <section class="cards-box">
            <div class="container">
                <div class="row">
                    <div class="col-12">
                        <div class="row cards-box-body mt-3">


                            {% endif %}

                            <div class="col-6">
                                {{ include(_self|replace({ "content.html.twig":"brand.html.twig" })) }}
                            </div>

                            {# {{ brand.attr }} #}


                            {% set ALPHABET = ABC %}

                            {% endfor %}


                        </div>


                    </div>


                    {% endif %}


</main>